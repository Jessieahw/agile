<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Which EPL Team and Player Are You?</title>
    <link rel="stylesheet" href="epl.css">
    
</head>
<body>
    <header class="header-bar">
        <img src="./Premier_League_Logo.svg" alt="Premier League Logo" class="logo">
        <h1>Which EPL Team and Player Are You?</h1>
    </header>

    <!-- Part 1: Team Recommendation -->
     <div class="content">
        <div class="white-box">
            <h3>Find Your EPL Team</h3>
            <p>Enter your stats below to find out which EPL team matches your play style. Please ensure your stats are realistic and within the suggested ranges:</p>
            <ul>
                <li><strong>Average Shots per Match:</strong> The average number of shots your team takes per match (e.g., 10).</li>
                <li><strong>Average Goals per Match:</strong> The average number of goals your team scores per match (e.g., 1.5).</li>
                <li><strong>Fouls per Match:</strong> The average number of fouls your team commits per match (e.g., 8).</li>
                <li><strong>Cards per Match:</strong> The average number of yellow and red cards your team receives per match (e.g., 1.2).</li>
                <li><strong>Shot Accuracy:</strong> The percentage of shots on target, represented as a decimal (e.g., 0.5 for 50%).</li>
            </ul>
            <form id="teamForm">
                <label for="avgShots">Average Shots per Match:</label>
                <input type="number" id="avgShots" name="avgShots" step="0.01" min="0" required>
        
                <label for="avgGoals">Average Goals per Match:</label>
                <input type="number" id="avgGoals" name="avgGoals" step="0.01" min="0" required>
        
                <label for="avgFouls">Fouls per Match:</label>
                <input type="number" id="avgFouls" name="avgFouls" step="0.01" min="0" required>
        
                <label for="avgCards">Cards per Match:</label>
                <input type="number" id="avgCards" name="avgCards" step="0.01" min="0" required>
        
                <label for="shotAccuracy">Shot Accuracy (e.g., 0.75 for 75%):</label>
                <input type="number" id="shotAccuracy" name="shotAccuracy" step="0.01" min="0" max="1" required>
        
                <button type="button" onclick="recommendTeam()">Find Your EPL Team</button>
            </form>
        </div>
    
    <div id="resultModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <p id="modalText"></p>
        </div>
    </div>

        
    <script>
        function openModal(resultText) {
    console.log('Opening modal with text:', resultText); // Debugging: Check the text being passed
    const modalTextElement = document.getElementById("modalText");
    const modalElement = document.getElementById("resultModal");

    if (!modalTextElement || !modalElement) {
        console.error("Modal or modal text element not found!");
        return;
    }

    modalTextElement.textContent = resultText;
    modalElement.style.display = "block";

    console.log('Modal text updated to:', modalTextElement.textContent); // Debugging: Check if text is updated
    console.log('Modal display style:', modalElement.style.display); // Debugging: Check if modal is visible
}

        function closeModal() {
            document.getElementById("resultModal").style.display = "none";
        }
        
        let eplTeams = [];

        

        function fetchCSV() {
            Papa.parse('epl data/team_comparison_stats.csv', {
                download: true,
                header: true,
                dynamicTyping: true, // Automatically convert numbers
                complete: function(results) {
                    eplTeams = results.data;
                    console.log('Teams loaded:', eplTeams);

                    // Enable the button once data is loaded
                    document.querySelector('button[onclick="recommendTeam()"]').disabled = false;
                },
                error: function(error) {
                    console.error('Error parsing CSV:', error);
                }
            });
        }

        // Disable the button initially
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelector('button[onclick="recommendTeam()"]').disabled = true;
            fetchCSV();
        });



        function recommendTeam() {
            // Check if eplTeams is loaded
            if (eplTeams.length === 0) {
                openModal("Team data is still loading. Please try again in a moment.");
                return;
            }

            const avgShots = parseFloat(document.getElementById("avgShots").value);
            const avgGoals = parseFloat(document.getElementById("avgGoals").value);
            const avgFouls = parseFloat(document.getElementById("avgFouls").value);
            const avgCards = parseFloat(document.getElementById("avgCards").value);
            const shotAccuracy = parseFloat(document.getElementById("shotAccuracy").value);
            
            console.log('User Input:', { avgShots, avgGoals, avgFouls, avgCards, shotAccuracy }); // Debugging: Check user input

            if (!avgShots || !avgGoals || !avgFouls || !avgCards || !shotAccuracy) {
                openModal("Please enter valid stats.");
                return;
            }

            if (avgShots > 50 || avgGoals > 10 || avgFouls > 50 || avgCards > 10 || shotAccuracy > 1 || shotAccuracy < 0) {
                openModal("Please enter realistic stats.");
                return;
            }

            let closestTeam = null;
            let smallestDistance = Infinity;

            eplTeams.forEach(team => {
                console.log('Comparing with team:', team); 
                const distance = Math.sqrt(
                    Math.pow(avgShots - team['Average Shots per Match'], 2) +
                    Math.pow(avgGoals - team['Average Goals per Match'], 2) +
                    Math.pow(avgFouls - team['Average Fouls per Match'], 2) +
                    Math.pow(avgCards - team['Average Cards per Match'], 2) +
                    Math.pow(shotAccuracy - team['Shot Accuracy'], 2)
                );

                if (distance < smallestDistance) {
                    smallestDistance = distance;
                    closestTeam = team['Team'];
                }
            });

            console.log('Closest Team:', closestTeam);
            openModal(`You are most like: ${closestTeam}`);
        }
    </script>



<!-- Part 2: Player Comparison -->
<div class="white-box">
    <h3>Compare Your Stats to EPL Players</h3>
    <p>Enter your stats to see how you compare to professional EPL players:</p>

    <!-- Dropdown to select position -->
    <label for="position">Select Your Position:</label>
    <select id="position" name="position" onchange="updateForm()">
        <option value="">--Select Position--</option>
        <option value="Forward">Forward</option>
        <option value="Midfielder">Midfielder</option>
        <option value="Defender">Defender</option>
        <option value="Goalkeeper">Goalkeeper</option>
    </select>

    <!-- Dynamic form fields -->
    <form id="playerForm">
        <div id="formFields"></div>
        <button type="button" onclick="comparePlayer()">Compare Your Stats</button>
    </form>

    <div id="playerResult"></div>
</div>

<script>
    // Define the fields for each position
    const positionFields = {
        Forward: [
            { label: "Goals", id: "goals" },
            { label: "Assists", id: "assists" },
            { label: "Shots", id: "shots" },
            { label: "Shots on Target", id: "shotsOnTarget" },
            { label: "Shooting Accuracy (%)", id: "shootingAccuracy" }
        ],
        Midfielder: [
            { label: "Goals", id: "goals" },
            { label: "Assists", id: "assists" },
            { label: "Passes", id: "passes" },
            { label: "Tackles", id: "tackles" },
            { label: "Interceptions", id: "interceptions" }
        ],
        Defender: [
            { label: "Tackles", id: "tackles" },
            { label: "Interceptions", id: "interceptions" },
            { label: "Clearances", id: "clearances" },
            { label: "Blocked Shots", id: "blockedShots" },
            { label: "Duels Won", id: "duelsWon" }
        ],
        Goalkeeper: [
            { label: "Clean Sheets", id: "cleanSheets" },
            { label: "Goals Conceded", id: "goalsConceded" },
            { label: "Saves", id: "saves" },
            { label: "Penalties Saved", id: "penaltiesSaved" },
            { label: "High Claims", id: "highClaims" }
        ]
    };

    // Function to update the form based on the selected position
    function updateForm() {
        const position = document.getElementById("position").value;
        const formFields = document.getElementById("formFields");

        // Clear existing fields
        formFields.innerHTML = "";

        // Add fields for the selected position
        if (positionFields[position]) {
            positionFields[position].forEach(field => {
                const label = document.createElement("label");
                label.setAttribute("for", field.id);
                label.textContent = field.label;

                const input = document.createElement("input");
                input.setAttribute("type", "number");
                input.setAttribute("id", field.id);
                input.setAttribute("name", field.id);
                input.setAttribute("required", true);

                formFields.appendChild(label);
                formFields.appendChild(input);
            });
        }
    }

    // Function to compare player stats (example logic)
    function comparePlayer() {
        const position = document.getElementById("position").value;
        if (!position) {
            alert("Please select a position.");
            return;
        }

        const userStats = {};
        positionFields[position].forEach(field => {
            userStats[field.id] = parseFloat(document.getElementById(field.id).value) || 0;
        });

        console.log("User Stats:", userStats);

        // Example comparison logic 
        // const examplePlayer = {
        //     Forward: { goals: 20, assists: 10, shots: 50, shotsOnTarget: 30, shootingAccuracy: 60 },
        //     Midfielder: { goals: 10, assists: 15, passes: 2000, tackles: 50, interceptions: 30 },
        //     Defender: { tackles: 100, interceptions: 80, clearances: 150, blockedShots: 20, duelsWon: 120 },
        //     Goalkeeper: { cleanSheets: 15, goalsConceded: 30, saves: 100, penaltiesSaved: 5, highClaims: 50 }
        // };

        const comparison = examplePlayer[position];
        let result = `Comparison for ${position}: `;
        for (const stat in userStats) {
            result += `${stat}: You (${userStats[stat]}) vs Pro (${comparison[stat]}) | `;
        }

        document.getElementById("playerResult").textContent = result;
    }
</script>



</div>
</body>
</html>